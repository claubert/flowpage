<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pagamento PIX • Flowhedge</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body{font-family:Inter,system-ui,Arial,sans-serif;margin:0;padding:0;background:#0b1220;color:#f4f7ff}
    header{display:flex;justify-content:space-between;align-items:center;padding:16px 24px;background:#0e1628;border-bottom:1px solid #18233a}
    nav a{color:#cfe2ff;text-decoration:none;margin-left:16px}
    main{max-width:720px;margin:24px auto;padding:0 24px}
    .card{background:#111a2e;border:1px solid #1d2a49;padding:16px;border-radius:10px}
    input,button{width:100%;padding:10px;border-radius:8px;border:1px solid #1d2a49;background:#0e1628;color:#e6edff}
    button.primary{background:#22c55e;border:none;margin-top:10px}
    code{word-break:break-all}
  </style>
</head>
<body>
  <header>
    <div>Flowhedge</div>
    <nav>
      <a href="/">Home</a>
      <a href="/planos.html">Planos</a>
      <a href="/login.html">Login</a>
    </nav>
  </header>
  <main>
    <div class="card">
      <h2>Pagamento via PIX</h2>
      <p>Copie o código PIX abaixo e finalize o pagamento:</p>
      <code id="pix"></code>
      <button class="primary" onclick="copiar()" aria-label="Copiar código PIX">Copiar Código</button>
      <p id="status"></p>
      <button onclick="marcarPago()" aria-label="Confirmar pagamento (simulação)">Marcar como Pago (simulação)</button>
    </div>
  </main>
  <script>
    const u=new URLSearchParams(location.search);
    const idExterno=u.get('id_externo')||localStorage.getItem('pix_id_externo')||'';
    async function carregar(){
      const r=await fetch('/pagamento/status?id_externo='+idExterno);
      const j=await r.json();
      document.getElementById('pix').textContent='PIX:FLOWHEDGE:'+idExterno;
      const p=j.pagamento;
      const st=document.getElementById('status');
      if(!p){st.textContent='Aguardando início...';return}
      if(p.status==='pago'){st.textContent='Pagamento confirmado! Vá para cadastro/login.';setTimeout(()=>{location.href='/cadastro.html'},1500)}
      else if(p.status==='falhou'){st.textContent='Pagamento falhou. Tente novamente.'}
      else {st.textContent='Aguardando confirmação...';}
    }
    async function marcarPago(){
      const r=await fetch('/pix/confirmar',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({id_externo:idExterno})});
      await carregar();
    }
    function copiar(){
      navigator.clipboard.writeText(document.getElementById('pix').textContent);
    }
    carregar();
  </script>
</body>
</html>